# Rancilio Silvia PID Controller (ESP32-C6)

A PID temperature controller for the Rancilio Silvia espresso machine, running on an ESP32-C6. Features a web dashboard, configuration over WiFi, MQTT integration (Home Assistant), and OTA updates.

## Features

- **PID Control**: Precise temperature control using QuickPID.
- **Web Dashboard**: Monitor temperature, target, output, and adjust settings via a responsive web UI.
- **WiFi Portal**: Easy configuration of WiFi credentials and MQTT settings using WiFiManager.
- **OTA Updates**: Over-The-Air firmware updates via ElegantOTA.
- **Data Persistence**: Settings saved to flash memory.
- **Safety**: Fault detection for temperature sensor.

## Hardware Wiring

### ESP32-C6 DevKitC-1

| Component | ESP32 Pin | Notes |
| :--- | :--- | :--- |
| **SSR Control** | GPIO 20 | Controls the Solid State Relay (Heater) |
| **MAX31865 CS** | GPIO 14 | SPI Chip Select |
| **MAX31865 MOSI** | GPIO 15 | SPI MOSI |
| **MAX31865 MISO** | GPIO 18 | SPI MISO |
| **MAX31865 SCK** | GPIO 19 | SPI Clock |

**Note:** Ensure your SSR can handle the current requirements of the boiler.

## Usage

1.  **First Boot**: The device will create a WiFi AP named `Silvia-PID-Config`. Connect to it (Password: `password` or none, check logs) and configure your WiFi and MQTT settings.
2.  **Web Dashboard**: Once connected, navigate to `http://<device-ip>/`.
    - **Current Temp**: Big display of boiler temperature.
    - **Target Temp**: Configured setpoint (configurable).
    - **PID Tuning**: Adjust proportional (Kp), integral (Ki), and derivative (Kd) terms to optimize heater response.
    - **Manual Override**: Toggle switch to force heater ON (100% duty) for testing or manual control.
      > **Safety Note**: If the sensor detects a fault (e.g., 0.0Â°C or disconnected), the Manual Override will automatically disable and turn off the heater to prevent overheating.
3.  **OTA Updates**:
    - Go to `http://<device-ip>/update` or click the cloud icon/link in the dashboard.
    - Upload the `firmware.bin` file generated by PlatformIO (`.pio/build/esp32-c6-devkitc-1/firmware.bin`).

## Simulation / Testing Mode

If no temperature sensor is connected:
- The system generally reads `0.00 C`.
- The Fault Code might display an error (e.g., Open Circuit).
- **Safety Feature**: If a critical fault is detected, the system forces **MANUAL MODE** with **0% Output** to prevent overheating.
- To simulate heating: You can use the "Manual Override" toggle in the dashboard, but safety logic in `loop()` will immediately turn it off if a valid fault is present. To bypass this, you must modify `src/main.cpp` safety logic or connect a valid sensor/resistor.

## Development

- Built with **PlatformIO**.
- Dependencies: `ESPAsyncWebServer`, `AsyncTCP`, `ElegantOTA`, `QuickPID`, `ArduinoJson`, `WiFiManager`, `PubSubClient`.

### Build & Upload
```bash
pio run -t upload
```
